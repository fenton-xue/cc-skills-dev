---
name: merge-cells
description: 处理Excel测试用例文件，合并步骤描述和预期结果列。当需要处理测试用例Excel文件，将多个连续行的步骤描述和预期结果合并到用例名称有值的行时使用此skill。功能包括：1) 给步骤描述和预期结果列的每个单元格内容前加上#号，2) 根据用例名称列找到有值的行，3) 将连续行的步骤描述和预期结果合并到第一个有值的行。
---

# merge-cells

## 功能说明

此Skill用于处理Excel测试用例文件，实现以下功能：

1. **添加#号前缀**：给"步骤描述"列和"预期结果"列的每个单元格内容前面加上#号（每个单元格只加1个）
2. **合并单元格内容**：根据"用例名称"列找到有值的行，将连续行的步骤描述和预期结果合并到第一个有值的行

## 处理逻辑

1. **默认处理第一个sheet页**
2. **添加#号前缀**：
   - 遍历"步骤描述"列和"预期结果"列的所有单元格
   - 如果单元格有内容且不是以#开头，则在内容前加上#号
   - 每个单元格只加1个#号
3. **查找用例名称有值的行**：
   - 从第2行开始，向下查找"用例名称"列有值的行
   - 先判断整个文档的最后一行，防止向下查找找不到有值的行
4. **合并内容**：
   - 找到用例名称有值的行（如第2行、第6行）
   - 将第2-5行的步骤描述内容直接拼接在第2行的单元格里（无分隔符）
   - 将第2-5行的预期结果内容直接拼接在第2行的单元格里（无分隔符）
   - 继续循环，从第6行往下，处理6-25行的步骤描述和预期结果在第6行的对应单元格内
   - 重复此过程直到文档末尾

## 执行步骤

当用户执行此Skill时，请按以下步骤操作：

1. **解析参数**
   - 从 `{{input}}` 参数获取Excel文件路径
   - 从 `{{output}}` 参数获取输出Excel文件路径（如果提供，否则覆盖原文件）

2. **调用Python脚本处理Excel**
   - 脚本路径：`merge-cells/scripts/merge_cells.py`
   - 执行命令：
     ```bash
     conda run -n claude-code --no-capture-output python \
       merge-cells/scripts/merge_cells.py \
       <input_file_path> [<output_file_path>]
     ```
   - 脚本会：
     * 读取Excel文件第一个sheet
     * 自动识别"用例名称"、"步骤描述"、"预期结果"列
     * 给步骤描述和预期结果列的每个单元格内容前加上#号
     * 根据用例名称列找到有值的行
     * 合并连续行的步骤描述和预期结果到第一个有值的行
     * 保存处理后的Excel文件

3. **报告结果**
   - 向用户展示处理摘要：
     * 处理的文件路径
     * 找到的用例名称行数
     * 合并的行数
     * 输出文件路径

## 注意事项

- 默认处理第一个sheet页
- 每个单元格只加1个#号，不会重复添加
- 合并时直接拼接，不使用任何分隔符
- 如果用例名称列始终向下查找找不到有值的行，脚本会先判断文档的最后一行
- 脚本会自动识别列名，支持中文列名

## 列名识别

脚本会自动识别以下列名（不区分大小写）：
- **用例名称列**：包含"用例名称"、"用例名"、"名称"等关键词
- **步骤描述列**：包含"步骤描述"、"步骤"、"描述"等关键词
- **预期结果列**：包含"预期结果"、"结果"、"预期"等关键词
