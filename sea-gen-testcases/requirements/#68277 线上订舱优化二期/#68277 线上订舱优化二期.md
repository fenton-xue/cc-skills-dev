# 取消订舱/异常操作支持批量操作等相关优化

## 变更记录

| **日期**   | **修改内容**                                 | **修改人** |
| ---------- | -------------------------------------------- | ---------- |
| 2025-10-10 | 新建文档 #68277 线上订舱优化二期 [task-link] | 梁骁       |



### 需求背景

1. 因订舱上线后，业务希望将前后端工作分离，让海运前端的工作都在订舱模块完成，故需要在订舱模块支持相应的功能操作：比如标签、ISF等；
2. 目前物流备注信息是前后端公用一个备注，难以区分需要自己关注的备注项，故需要拆分备注；
3. 支持业务批量忽略异常，及批量取消订舱功能；



### 需求清单

1. 订舱邮件模版内容调整；

2. 录入SO增加字段；

3. 订舱详情页字段调整；

4. 物流备注功能调整；

5. 订舱管理支持添加/删除标签；

6. 订舱结果的订舱详情页支持当前页编辑；

7. 支持批量取消订舱功能；

8. 订舱异常待处理列表功能调整

9. 1. 重发功能说明
   2. 支持批量忽略异常；

10. 订舱管理列表字段及查询项字段调整；

11. 订舱管理导入功能调整；

12. 订舱模块其他优化；

13. 海运订单管理调整；



### 需求说明：

#### 一、订舱邮件模版内容调整

- 订舱邮件中，邮件正文的【托书备注】默认带出内容调整：

1. 原有带出显示逻辑如下：

![img](#68277 线上订舱优化二期.assets/tOKL7vaoTvlnqz85KNs4mp4DUc52rzXARF4aNUqQV_Y.png)

1. 现调整为：第1、3、4条保持不变；第2条海运保险无论是否需要购买，皆不带出；显示的序号自动调整按照顺序计数；



- 【托书备注】字段支持编辑，同时【托书备注】【其他备注】字段支持一键清除；

- - 当“托书备注”、“其他备注”字段输入框有值时，出现一键清空的删除图标，鼠标移入图标变红，点击可清除输入框中的所有信息；大致样式如下：

- 

- 

- #### 二、录入SO增加字段

- - 订单类型：美国、加拿大非自发订单；（欧日不加）
  - 当操作录入SO时，弹窗增加字段【是否有火车运输】字段：下拉选项，选项有：是、否，默认显示请选择；
  - 该字段必填，保存时需校验，若填写，控件下方红字提示：请选择

- 

- 

- #### 三、订舱详情页字段调整

- - 字段【船名航次】输入框增加删除图标，支持一键清空；
  - **B2B美国、加拿大**非自发订单：增加字段【是否有火车运输】、【ISF代理简称】、【ISF】、【清关代理简称】；
  - **3PL、OSJ 的美国/加拿大**非自发订单：增加字段【是否有火车运输】、【ISF】、【清关代理简称】；
  - **德国、英国、日本**非自发订单：增加字段【清关代理简称】；

- 1. 字段显示及输入逻辑保持不变，只是支持在订舱详情页编辑；
  2. 【是否有火车运输】：放在“目的港”字段后，必填；
  3. 【ISF代理简称】：放在“实际离港日ATD”字段后；-- 委托ISF申报的订单才有该字段，保存时需验证订单是否有ISF申报服务，若没有与之前订单详情处编辑一样需提示刷新；
  4. 【ISF】：放在“ISF代理简称”字段后；
  5. 【清关代理简称】：放在“ISF”字段后；

- - 上述字段仍是在已订舱状态下支持在订舱详情页编辑；（遵循订舱详情页编辑的原有逻辑）；
  - 当录入ATD时，【ISF代理简称】、【ISF】、【清关代理简称】字段不参与海运前需填写字段校验，【是否有火车运输】需参与校验；
  - 若订单取消订舱时，【ISF代理简称】、【ISF】、【清关代理简称】、【是否有火车运输】需清空；
  - 第二版：订舱撤回取消后，上述新加的清空字段值需一并恢复；
  - 订单重新申请时，【ISF代理简称】、【ISF】、【清关代理简称】、【是否有火车运输】需清空；

- 

- 注：订舱详情新增的字段，记录里需要兼容，记录规则仍保持不变；

- 

- #### 第二版：四、物流备注功能调整

- - 非自发订单物流备注区分“起运港备注”、“清关备注”、“目的港备注”；
  - 自发订单物流备注区分“清关备注”、“目的港备注”；
  - local订单物流备注为“目的港备注”；
  - 功能说明：

- 1. 入口1：海运业务管理 > 订舱管理 > 待订舱/订舱中、订舱结果 > 操作按钮“物流备注”；
  2. 入口2：订单管理 > 海运订单管理 > 操作按钮“物流备注”；
  3. 入口3：订单管理 > 陆运订单管理 > 操作按钮“物流备注”；
  4. 入口4：海运业务管理 > 船期分配管理 > 发船审核/审核结果 > 操作按钮“备注” ；

- - 点击以上按钮，打开物流备注弹窗，根据订单类型显示不同弹窗，

  - - 非自发订单 弹窗如下：

  - 1. 起运港备注、目的港备注、清关备注：都最大支持400字符，前后空格需去除，皆不必填；

  - 

  - - 自发订单 弹窗如下：

  - 

  - - local订单 弹窗如下：

  - 

  - - 列表显示说明：

  - 1. 订舱模块2个列表中的去掉物流备注字段，改显示“起运港备注”，显示起运港备注信息；

    2. 1. 起运港备注最多显示3行，若3行仍显示不全，则第三行末尾...显示，鼠标移入气泡显示完整信息；

    3. 

    4. 

    5. 1. 船期分配管理2个列表将原 “物流备注” 字段去除，分为3个字段显示：起运港备注、目的港备注、清关备注；（2个列表下载也需要有这3个字段）

       2. 海运订单列表将原 “物流备注” 字段去除，全量组合增加3个字段：起运港备注、目的港备注、清关备注；

       3. 1. 海运订单列表【导出】list字段调整物流备注字段去掉，依次增加【起运港备注】【目的港备注】【清关备注】；

       4. 

       5. 1. 陆运订单管理列表，物流备注字段改显示为“目的港备注”，导出也同样改显示为“目的港备注”；
          2. 运维点确认：需确认线上订单原物流备注字段值需要怎么处理？ -- 拉取线上数据，业务进行拆分；

       6. 

       7. - 详情页显示说明：

       8. 1. 入口：海运订单管理/电子入库单管理 进入的订单详情页、订舱结果列表 进入的详情页
          2. 将以上入口处的物流备注字段改为不支持编辑，输入框置灰，在输入框中显示“起运港备注”、“目的港备注”、“清关备注”；3个字段中无值的字段过过滤不显示；
          3. 同时在上述页面右上角增加“物流备注”编辑的功能按钮，点击打开“物流备注”编辑弹窗；

       9. 

       10. 

       11. 

       12. #### 五、订舱模块支持添加标签/删除标签功能；

       13. 功能与海运订单管理处的【批量添加标签、批量删除标签】功能及交互一致；

       14. 入口1：海运业务管理 > 订舱管理 > 待订舱/订舱中 > 【其他操作】下增加功能按钮【批量添加标签】、【批量删除标签】；

       15. 

       16. 入口2：海运业务管理 > 订舱管理 > 订舱结果 > 列表左上方，新增按钮【其他操作】，调整【修改货重】、【修改海运时间】、【带电池标记】至其下拉选择项中，并添加按钮【批量添加标签】、【批量删除标签】；

       17. 

       18. - 系统权限菜单调整如下：

       19. 

       20. 

       21. - 批量添加标签 功能简述：

       22. 1. 勾选订单后，点击“批量添加标签”按钮，打开编辑标签弹窗；未勾选订单，toast提示：请至少选择1条数据；
           2. 弹窗样式不变，按标签组显示所有的标签，
           3. 选中/取消选中交互与海运订单一致；
           4. 保存时，需要判断用户对应角色是否有“订舱管理”相应入口的“批量添加标签”的功能权限，若无则toast提示：无功能权限；
           5. 保存之后，订舱详情页及订舱列表需显示订单标签，详情页显示位置与海运订单处一致，可支持在订舱详情页编辑标签；
           6. 对订单标签的编辑（添加/删除），订舱管理和海运订单管理2个模块需同步；（添加和移除都同步）

       23. 添加标签弹窗样式如下：（勾选订单后点击功能按钮，打开该弹窗）

       24. 

       25. - 订舱详情页显示如下：（点击“编辑标签”按钮，打开上述编辑标签弹窗）

           - - 点击编辑标签，打开编辑标签弹窗后，点击保存按钮时，需增加功能权限的判断；
             - 订舱管理菜单 > 订单流程明细 下增加子功能菜单：编辑标签、查看标签；
             - 若用户对应角色无“编辑标签”权限，则编辑弹窗里点击“保存”按钮时，需toast提示：无功能权限；
             - 若用户对应角色无“查看标签”权限，则订舱详情页不展示订单标签；

           - 

           - 

           - 

           - - 批量删除标签 功能简述：

           - 1. 批量删除标签需选择需要删除的标签后查询出有该标签的订单，再勾选需要删除标签的订单，点击“批量删除标签”按钮，进行操作；
             2. 若未选择标签，需toast提示：请先选择要删除的标签进行数据搜索；
             3. 选择标签后，若未勾选订单，需toast提示：至少选择一条数据!
             4. 点击“批量删除标签”按钮打开下述弹窗，二次确认需要删除的订单；
             5. 点击“确认”按钮，需要判断用户对应角色是否有“订舱管理”相应入口的“批量删除标签”的功能权限，若无则toast提示：无功能权限；
             6. 其余校验与海运订单处一致；

           - 

           - 

           - 

           - #### 六、订舱结果tab支持当前页编辑海运前信息

           - - 入口：海运业务管理 > 订舱管理 > 订舱结果  > 列表操作列增加功能按钮“编辑”
             - 操作列按钮：编辑、更多；其中“取消”、“去处理、“记录”、“物流备注”按钮聚合在“更多”里；

           - 

           - - 按钮显示逻辑说明：

           - | **按钮** | **显示说明**                                                 |                                                              |
             | -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
             | 编辑     | 用户是否有该按钮的功能权限，需根据用户角色是否有 “订舱管理 >订单流程明细 > 编辑 ”权限，若无该权限，则不显示该按钮； ![img](#68277 线上订舱优化二期.assets/tc0CJ9h9PNXG9v8Ltam3MH-D38X2e279l-Ed6W2aB_Q.png) 若订单的订舱详情不支持编辑，则按钮置灰，悬移显示置灰原因； 置灰原因有： 订舱异常，不支持操作 订单审核中，不支持操作  订单已取消/已完成，不支持操作 若同时发生，显示优先级：订单已取消/已完成 > 订单审核中 > 订舱异常； |                                                              |
             | 更多     | 取消                                                         | 按钮的显示及置灰逻辑不变，显示逻辑如下： 海运中之前的订单： 实际进港日无值，则有【取消】按钮； 但当订舱异常时，无【取消】按钮； 当订单处于审核状态时，取消按钮置灰； 实际进港日有值，则无【取消】按钮； 海运中及之后状态的订单，无【取消】按钮； 完成及取消状态的订单，无【取消】按钮； |
             | 去处理   | 按钮的显示逻辑不变（修改待审核”、“撤回待审核“、”撤回-驳回“、“内部修改审核” 中不支持处理异常，“去处理”按钮置灰） |                                                              |
             | 物流备注 | 按钮的显示逻辑不变                                           |                                                              |

           - - 点击 “编辑”按钮，当前页面打开“订单海运前明细编辑”抽屉，如下：

           - 

           - - 显示字段：

           - 预计发船周期、起运港、箱型、货运代理简称、放舱时间、首次ETD、船公司、提单号、航程类型、船名航次、截单时间、预计离港日ETD、预计到港日ETA、目的港、是否有火车运输、集装箱号、货重、实际进港日、实际离港日ATD、ISF代理简称、ISF、清关代理简称、客户放行、货代放行；

           - - 字段显示及校验逻辑皆与订单详情页一致；
             - 保存时，需校验用户角色是否有 “订舱管理 >订单流程明细 > 编辑 ”权限，若无该权限，需toast提示：无功能权限；
             - 其余校验与订舱详情页保存校验一致；

           - 

           - #### 七、订舱管理支持批量取消订舱功能（取消之后的处理逻辑不变）

           - - 订单在订舱中，已订舱状态下，发取消邮件时，若触发邮件发送失败异常时，操作记录的先后顺序做一下调整，先记录发取消邮件的动作，再记录订单异常；

           - 

           - 

           - #### （1）待订舱/订舱中tab**支持批量取消订舱**

           - - 入口：订舱管理 > 待订舱/订舱中 列表上方增加功能按钮 “批量取消订舱”，下拉显示功能按钮 “直接取消”、“批量发取消邮件”，支持业务可批量取消订舱；

             - “批量取消订舱”按钮中的勾选框，支持勾选后筛选出可操作取消订舱的订单数据，勾选框默认不勾选；（需查询最新数据）

             - - 订舱状态为：订舱中 且 审核状态为空，且 无订舱异常的订单支持批量操作 “取消订舱”功能，满足该条件的订单可通过筛选功能查询出来；

             - 按钮交互说明：

           - | **场景**       | **样式**                                                     | **说明**                                   |
             | -------------- | ------------------------------------------------------------ | ------------------------------------------ |
             | 正常展示       | ![img](#68277 线上订舱优化二期.assets/PlaELgEQb0jw9dQXt5E09wP05R9tdCmP3xrBhXtgMGo.png) |                                            |
             | 鼠标移入       | ![img](#68277 线上订舱优化二期.assets/jmZ-9vfndIZuYEyF_xa7EZdMXLzUWfnBUvxLWPr1Pu4.png) | 气泡提示：可点击筛选支持取消订舱操作的订单 |
             | 勾选           | ![img](#68277 线上订舱优化二期.assets/Kj_1uGn_jKk6-I6heDFs0ewoEVCJ3_sNNUtzINxWCLI.png) | 气泡提示：可点击筛选支持取消订舱操作的订单 |
             | 勾选后鼠标移出 | ![img](#68277 线上订舱优化二期.assets/LAEyo_aPKpAVGNNgaZTcgNY5Vc2ButR3s3BPRxHT6bQ.png) |                                            |

           - - 将原【批量发邮件】按钮更名为：【批量发订舱邮件】；

           - 

           - - 功能权限菜单调整说明：

           - 1. 订舱管理 > 待订舱/订舱中 菜单下 增加子菜单：批量取消订舱，该菜单下增加子菜单：直接取消、发取消邮件；
             2. 将原菜单“批量发邮件”更名为“批量发订舱邮件”；

           - 

           - - **直接取消功能说明：**

           - 1. 订舱状态为：订舱中 且 审核状态为空，且 无订舱异常的订单支持批量操作 “直接取消”功能；
             2. 点击【直接取消】按钮，需校验：是否有选择订单数据，若未选，toast提示：请选择订单！
             3. 若已选订单，打开直接取消的二次确认弹窗：

           - 

           - 1. 弹窗列表显示字段：序号、系统订单号、入库单号、订舱状态、订单状态、货运代理简称、起运港、目的港、预计发船周期；

             2. 点击确定按钮，需校验用户角色是否有相应功能权限，若无需toast提示：无功能权限；

             3. 同时，若有不满足下述校验的订单需以异常提示弹窗进行提示，并告知失败原因，满足校验的订单则取消成功；

             4. 1. 订单的订舱状态是否为：订舱中，若不是则失败原因显示为：订舱状态已变更，请刷新后操作；
                2. 订单处于“修改待审核”、“撤回待审核“、”撤回-驳回“、“内部修改审核中”，若是则失败原因显示为：订单xxx，不支持取消；其中xxx为具体审核状态；
                3. 订单是否处于订舱异常，若是则失败原因显示为：订单异常，不支持取消；
                4. 订单是否取消订舱的邮件正在发送中，如是则失败原因显示为：订单正在发送取消邮件，无需重复操作；

             5. 

             6. 

             7. - **批量发送取消邮件功能说明：**

             8. 1. 订舱状态为【订舱中】，【相同来源系统 且 相同国别 且 相同货代】的订单 支持在一封邮件里发取消订舱邮件；

                2. 点击【批量发取消邮件】按钮，校验：

                3. 1. 否有选择订单数据，若未选，toast提示：请选择订单！

                   2. 已选订单是否满足下述校验，若不满足则toast提示：本次操作失败：请选择 “订舱中 且 来源系统/国别/货代相同”的订单批量发取消邮件

                   3. 1. 已选订单的订舱状态为【订舱中】；
                      2. 已选订单需为【相同来源系统 且 相同国别 且 相同货代】的订单 

                   4. 若已选订单有处于审核状态中的，弹窗提示：xxx bbb中，不支持操作！其中xxx为系统订单号，bbb为审核状态，多个订单分行显示

                   5. 若已选订单含异常订单的，弹窗提示：xxx订单异常，不支持操作！其中xxx为系统订单号，多个订单分行显示

                   6. 若同一个订单既处于审核状态、也是异常订单，则优先提示审核状态；

                   7. 若满足上述校验，打开【取消订舱- 发送邮件】弹窗：（OSJ订单跳过“选择抄送人邮箱”的弹窗）

                4. 

                5. - **收件人：**

                6. 1. 必填；不支持删除，不支持添加；
                   2. 自动带出原发订舱邮件的收件人邮箱 + 该货运代理配置的收件邮箱中与原发订舱邮件收件人不重合的邮箱；-- 第二版：区别在于：批量取消需要取所有已选订单的订舱邮件收件人邮箱并集；

                7. - **抄送人：**

                8. 1. 按来源系统和订单国别带出预设默认抄送人邮箱；
                   2. 其余交互及校验逻辑与现有一致；

                9. - **主题：**

                10. 1. 必填，按下方固定样式默认带出，支持修改，限制最多200字符；前后空格需处理掉；
                    2. B2B 德国/英国 的订单 主题：【来源系统+国别-取消订舱】发邮件当天日期+货运代理简称+工厂自己的VAT和EORI；
                    3. 其余订单通用主题：【来源系统+国别-取消订舱】发邮件当天日期+货运代理简称；

                11. - **上传附件：**交互及校验逻辑与现有一致；
                    - **邮件正文：**

                12. 1. 模板默认文本+表格，文本支持编辑；表格不支持编辑
                    2. 文本模板如下所示：（XXX为代理简称）

                13. ​      Hi XXX Team,

                14. ​      以下入库单请取消订舱，谢谢！

                15. 1. 表格：显示入库单号；

                16. 

                17. - “**确认发送**”**按钮说明：**

                18. 1. 需校验用户角色是否有相应功能权限，若无需toast提示：无功能权限；

                    2. 整体校验：

                    3. 1. 校验抄送人的邮箱格式是否正确，若不正确，输入框下红字提示；
                       2. 校验抄送人邮箱的数量是否超出限制，超出输入框下红字提示；
                       3. 校验抄送人邮箱是否重复；重复控件下提示；
                       4. 校验邮件主题是否已填，控件下方提示：请填写邮件主题！

                    4. 并发校验：

                    5. 1. 若所选订单的订舱状态发生变更，则弹窗提示：xxx订舱状态已变更，不支持发取消邮件！ xxx为系统订单号，多条数据分行显示；
                       2. 并发异常校验，若订单异常了，需弹窗提示：xxx订单异常，不支持发取消邮件！其中xxx为系统订单号，多个订单分行显示；
                       3. 订单是否处于“修改待审核”、“撤回待审核“、”撤回-驳回“、“内部修改审核中”状态中，若是则toast提示：xxx订单审核状态已变更，不支持发取消邮件！ xxx为系统订单号，多条数据分行显示；--- 其中，内部修改审核正常该场景下不会存在，但可能会存在订舱状态变成【已订舱】后发起内部修改审核的并发情况，这种情况下，优先提示“订舱状态变更”；
                       4. 校验 货运代理简称的收件邮箱是否有值，若无值toast提示：本次操作失败：货运代理邮箱未配置！
                       5. 校验 货运代理简称的收件邮箱是否发生变更； 变更了，toast提示：本次操作失败：货运代理邮箱已变更，请检查收件人邮箱！

                    6. 通过上述各种校验后，toast提示： 邮件已提交，后台正在投递中；可稍后刷新页面查看是否发送成功！

                19. 

                20. 1. 同时，返回列表页，订舱状态后增加"发送中”图标，邮件发送成功后，订舱状态变更为：待订舱，“发送中”图标消失；如下：

                21. 

                22. - 因为各种异常原因，造成邮件发送失败的， 相应订单出异常标识，异常原因为【邮件发送失败】，且 在“异常待处理”列表中增加该订单数据；（订舱状态依然是：订舱中）
                    - 异常订单，邮件投递成功后，同步变更订舱状态，同时异常图标消失；

                23. 

                24. #### （2）订舱结果tab**支持批量取消订舱；**

                25. - 入口：订舱管理 > 订舱结果 列表上方增加功能按钮 “批量取消订舱”，下拉显示功能按钮 “直接取消”、“批量发取消邮件”，支持业务可批量取消订舱；

                    - 同样 “批量取消订舱”按钮中的勾选框，支持勾选后筛选出可操作取消订舱的订单数据，勾选框默认不勾选；（需查询最新数据）

                    - - 订舱结果Tab下：确认发船中状态下的订单 、【实际进港日】无值  、审核状态为空 、无订舱异常，满足所有条件的订单支持批量操作取消订舱功能；满足该条件的订单可通过筛选功能查询出来；

                    - 

                    - - 功能权限菜单调整说明：

                    - 1. 订舱管理 > 订舱结果  菜单下 增加子菜单：批量取消订舱，该菜单下增加子菜单：直接取消、发取消邮件；

                    - 

                    - - **直接取消功能说明：**

                    - 1. 点击【直接取消】按钮，需校验：是否有选择订单数据，若未选，toast提示：请选择订单！

                      2. 若已选订单，打开直接取消的二次确认弹窗，弹窗样式、异常提示弹窗样式皆与“待订舱/订舱中”一致；

                      3. 点击弹窗确定按钮时，需校验用户角色是否有相应功能权限，若无需toast提示：无功能权限；

                      4. 同时需校验：

                      5. 1. 订舱状态是否为已订舱，若不是，失败原因显示为：订舱状态已变更，请刷新后操作
                         2. 进行中的订单实际进港日是否有值，若有值，失败原因显示为：订单“实际进港日”已填，不支持操作；
                         3. 订单处于“修改待审核”、“撤回待审核“、”撤回-驳回“、“内部修改审核中”，若是则失败原因显示为：订单xxx，不支持操作；其中xxx为审核状态；
                         4. 订单是否处于订舱异常，若是则失败原因显示为：订单异常，不支持操作；
                         5. 订单是否有取消订舱的邮件正在发送中，如是则失败原因显示为：订单正在发送取消邮件，无需重复操作；

                      6. 

                      7. - **批量发送取消邮件功能说明：**

                      8. 1. 支持取消订舱的订单 ，且 【相同来源系统 、 相同国别 、相同货代】的订单 支持在一封邮件里发取消订舱邮件；

                         2. 点击【批量发取消邮件】按钮，校验：

                         3. 否有选择订单数据，若未选，toast提示：请选择订单！

                         4. 已选订单是否满足下述校验，若不满足则toast提示：本次操作失败：请选择 “实际进港日未填写 且 来源系统/国别/货代相同”的进行中订单批量发取消邮件

                         5. 1. 已选订单需为进行中的订单；
                            2. 订单的实际进港日未填写；
                            3. 已选订单需为【相同来源系统 且 相同国别 且 相同货代】的订单 

                         6. 需校验所选订单当前的货运代理简称对应国别的邮箱是否已配置，若未配置，toast提示：收件人为空，不支持发邮件！

                         7. 若已选订单有处于审核状态中的，弹窗提示：xxx bbb中！其中xxx为系统订单号，bbb为审核状态；

                         8. 若已选订单含异常订单的，弹窗提示：xxx订单异常，不支持操作！其中xxx为系统订单号，多个订单分行显示

                         9. 若同一个订单即处于审核状态、也是异常订单，则优先提示审核状态；

                         10. 若满足上述校验，打开【取消订舱- 发送邮件】弹窗；同样OSJ订单跳过“选择抄送人邮箱”弹窗；

                      9. - **第二版：收件人：**

                      10. 1. 若所选订单皆通过线上订舱邮件订舱后，且在录入SO后未变更货运代理简称的，自动带出所有已选订单原发订舱邮件的收件人邮箱取并集 + 该货运代理配置的收件邮箱中与原发订舱邮件收件人不重合的邮箱；

                          2. 若通过线上订舱邮件订舱后，但在录入SO后 存在订单的货运代理简称已发生变更，收件人为：所有未变更货运代理的订单原发订舱邮件收件人邮箱并集+当前代理对应订单国别的邮箱中不重合的邮箱；

                          3. 若所选订单皆未发送订舱邮件，直接通过录入SO实现订舱状态流转的，自动获取当前货运代理对应国别的配置邮箱；

                          4. 若所选订单，存在部分发订舱邮件，部分未发订舱邮件的，收件人为：已发订舱邮件订单的订舱邮件收件人并集 + 当前代理对应订单国别的邮箱中不重合的邮箱

                          5. 1. 若发订舱邮件的订单中存在代理变更的，收件人为：所有未变更货运代理的订单原发订舱邮件收件人邮箱并集+当前代理对应订单国别的邮箱中不重合的邮箱；

                          6. - **抄送人：**

                          7. 1. 按来源系统和订单国别带出预设默认抄送人邮箱；
                             2. 其余交互及校验逻辑与现有一致；

                          8. - 邮件主题、附件、正文皆与上述一致；
                             - “**确认发送**”**按钮说明：**

                          9. 1. 需校验用户角色是否有相应功能权限，若无需toast提示：无功能权限；

                             2. 整体校验：

                             3. 1. 校验抄送人的邮箱格式是否正确，若不正确，输入框下红字提示；
                                2. 校验抄送人邮箱的数量是否超出限制，超出输入框下红字提示；
                                3. 校验抄送人邮箱是否重复；
                                4. 校验邮件主题是否已填，控件下方提示：请填写邮件主题！

                             4. 并发校验：

                             5. 1. 再次判断已选订单“货运代理简称”是否一致，若存在不一致的，弹窗提示：xxx货代不同，不支持批量发邮件！其中xxx为系统订单号；多条数据分行显示；
                                2. 需校验已选订单的【实际进港日】是否有值，若有值，弹窗提示：xxx实际进港日已填，不支持取消订舱！其中xxx为系统订单号；多条数据分行显示；
                                3. 若所选订单的订舱状态发生变更，则toast提示：xxx订舱状态已变更，不支持发取消邮件！ xxx为系统订单号，多条数据分行显示；
                                4. 并发异常校验，若订单异常了，需toast提示：xxx订单异常，不支持发取消邮件！其中xxx为系统订单号，多个订单分行显示；
                                5. 订单是否处于“修改待审核”、“撤回待审核“、”撤回-驳回“、“内部修改审核中”状态中，若是则弹窗提示：xxx订单审核状态已变更，不支持发取消邮件！ xxx为系统订单号，多条数据分行显示；
                                6. 需校验已选订单的货运代理简称是否统一发生了变更，若变更，toast提示：本次操作失败：货运代理简称已变更；
                                7. 校验 货运代理简称的收件邮箱是否有值，若无值toast提示：本次操作失败：货运代理邮箱未配置！
                                8. 校验 货运代理简称的收件邮箱是否发生变更； 变更了，toast提示：本次操作失败：货运代理邮箱已变更，请检查收件人邮箱！

                             6. - 通过上述各种校验后，后续处理逻辑保持不变（异常、非异常的：字段清空、订单及订舱状态回退、已匹配报价的相关逻辑处理、超重标签、集装箱免用时间等）；

                             7. 

                             8. #### （3）异常待处理列表批量取消功能优化

                             9. - 入口：订舱管理 > 异常待处理 列表上方功能按钮 “批量取消”；

                                - 该按钮前增加筛选功能，可快速筛选出支持“取消”操作处理异常的订单，勾选框默认不勾选；（需查询最新数据）

                                - - 取消按钮置灰的订单需过滤；
                                  - 鼠标移入气泡提示：可点击筛选支持取消订舱操作的订单；

                                - 

                                - - 该功能原先设计是：已选需满足取消条件后才能进入二次确认弹窗，对此逻辑进行优化；对原先二次确认弹窗进行优化，原先只有文案的二次确认，本次提示已选订单信息；
                                  - 功能说明：

                                - 1. 去掉原先点击【批量取消订舱】按钮时，对异常原因是否支持取消操作的校验；统一放到失败异常提示里进行提示；
                                  2. 原先的二次确认弹窗，修改成与上述“待订舱/订舱中”批量取消订舱弹窗一样的样式；
                                  3. 点击弹窗 “确定”按钮时，增加需校验：若订单 “仅有1个异常 且 异常原因为【邮件发送失败】” 不支持取消操作，失败原因显示为：该订单异常不支持取消操作

                                - 

                                - #### 八、订舱异常待处理Tab操作说明

                                - - 若异常原因为【邮件发送失败】的，鼠标悬移至标签后气泡提示如下：

                                - 

                                - | **场景**                 | **气泡提示文案**                                             |
                                  | ------------------------ | ------------------------------------------------------------ |
                                  | 单订舱邮件发送失败       | 订舱邮件发送失败                                             |
                                  | 批量订舱邮件发送失败     | 批量发送订舱邮件失败，订单数:n条，任一订单重发成功后，批量发送的所有订单皆自动取消异常；其中n为批量发送的订单数量； |
                                  | 单取消订舱邮件发送失败   | 取消订舱邮件发送失败                                         |
                                  | 批量取消订舱邮件发送失败 | 批量发送取消订舱邮件失败，订单数:n条，任一订单重发成功后，批量发送的所有订单皆自动取消异常；其中n为批量发送的订单数量； |

                                - - 操作按钮显示逻辑调调整：

                                - | **订舱异常场景**                                             | **显示按钮**     |
                                  | ------------------------------------------------------------ | ---------------- |
                                  | 仅【邮件发送失败】异常，且 失败的是订舱邮件                  | 记录、重发、忽略 |
                                  | 仅【邮件发送失败】异常，且 失败的是取消订舱邮件              | 记录、重发       |
                                  | 【邮件发送失败】异常+其他异常（这种只存在取消邮件失败的场景） | 记录、重发       |
                                  | 不含【邮件发送失败】异常，但异常原因中包含【订单已取消】or 【订单重新申请】 | 记录、取消       |
                                  | 不含【邮件发送失败】异常，且异常原因中不含【订单已取消】or 【订单重新申请】 | 记录、取消、忽略 |

                                - 

                                - #### （1）重发功能说明

                                - - 按钮置灰逻辑保持不变（审核状态中）

                                  - 若单个邮件发送失败的（含订舱、取消订舱），点击【重发】按钮，校验逻辑不变；

                                  - - 异常是否已处理、是否并发其他异常、订单是否取消或已重新申请、审核状态是否变更；

                                  - 单个邮件发送失败的，邮件编辑逻辑仍保持不变；

                                  - 如果是批量邮件失败的，重发提示弹窗中的提示文案需根据是订舱邮件失败 or 取消订舱邮件失败 变更：

                                - 

                                - | **场景**             | **提示文案**                                                 |
                                  | -------------------- | ------------------------------------------------------------ |
                                  | 批量订舱邮件失败     | 以下订单批量发订舱邮件失败，若重发邮件，则下列订单将一起批量重发 重发邮件成功后，将一起取消异常提示 |
                                  | 批量取消订舱邮件失败 | 以下订单批量发取消订舱邮件失败，若重发邮件，则下列订单将一起批量重发 重发邮件成功后，将一起取消异常提示 |

                                - - 若失败的是批量订舱邮件，则订单展示及确定按钮校验，保持原逻辑不变；

                                  - - 重新申请or取消订单需正常展示；
                                    - 确定时需判断所列订单是否已取消or重新申请，提示无法进行重发操作、异常是否已处理、校验国别/来源系统/货运代理是否一致、所选订单的审核状态；

                                  - 若失败的批量取消订舱邮件，则正常展示批量的订单，点击“确定”按钮时，无需校验订单是否已取消or重新申请；

                                  - - 需校验所列订单异常是否已处理，若已处理toast提示：订单异常已处理，请刷新重试！
                                    - 所列订单的审核状态是否变更，若变化toast提示：xxx订单审核状态已变更，不能批量重发！xxx为系统订单号，多个分行显示；
                                    - 上校验符合，打开邮件编辑弹窗：
                                    - 若是订舱邮件失败的，弹窗及页面逻辑皆不变；
                                    - 若是取消邮件失败的，需在原邮件编辑弹窗的基础上做如下调整：（邮件收件人、抄送人更新逻辑不变）

                                  - | 调整点                     | 具体说明                                                     |
                                    | -------------------------- | ------------------------------------------------------------ |
                                    | 点击“确认发送”按钮时       | 点击“确认发送”时：去掉 “订单异常已更新”的校验；              |
                                    | 弹窗下方操作栏             | 下方固定操作行 增加提示：若已线下邮件取消订舱，可点击操作 直接取消 > ![img](#68277 线上订舱优化二期.assets/CZpLETm0J26ehfLX8ZiZOeIj0zVwy58yoC1fJ741po8.png) 点击“直接取消>”文字按钮，打开直接取消弹窗： 若是单个取消订舱邮件失败的，弹窗为： 邮件编辑弹窗不关闭，遮罩后显示直接取消弹窗； ![img](#68277 线上订舱优化二期.assets/TQawNcAXlBs-Ra_8ilAKDxWJgIXgP6cj07dBlvC3p28.png) 点击“确认”按钮，需校验： 订舱异常是否已处理，若已处理，toast提示：本次操作失败：订单异常已处理，请刷新重试！ 订单是否处于审核状态中，若是则toast提示：订单xxx，不支持操作！其中xxx为具体审核状态； 校验符合后，关闭弹窗，toast提示：success，列表刷新，订单异常处理成功，且订单订舱已取消，取消后的处理逻辑保持不变； 点击【取消】和【X】：直接取消弹窗关闭，回到邮件编辑弹窗；   若是批量取消订舱邮件失败的，弹窗为： ![img](#68277 线上订舱优化二期.assets/THX9Xd_5Ijz2kbbS3tx9TuK71F9GaTsK-g9LqDaBJGs.png) 弹窗固定提示文案： 以下订单批量发取消订舱邮件失败，将一并直接取消订舱； 直接取消不会通过线上给代理发送邮件，只改变系统订舱状态，请再次确认是否操作直接取消？ 列表展示批量发取消订舱邮件的订单，列表字段：系统订单号、入库单号、国别、货运代理简称； 点击“确认”按钮，需校验： 需校验所列订单异常是否已处理，若已处理toast提示：订单异常已处理，请刷新重试！ 所列订单是否处于审核状态中，若有则toast提示：xxx订单bbb，不支持操作！xxx为系统订单号，bbb为具体审核状态；多个分行显示； 校验符合后，关闭弹窗，toast提示：success，列表刷新，相关订单异常处理成功，且相关订单订舱已取消，取消后的处理逻辑保持不变； 点击【取消】和【X】：直接取消弹窗关闭，回到邮件编辑弹窗； |
                                    | 第二版：重发成功后处理逻辑 | 若失败的是订舱邮件，重发成功后，订舱状态流转为“订舱中”，同时移出异常列表，异常图标消失； -- 原逻辑 若失败的是取消订舱邮件： 若无其他异常，若原订舱状态为：订舱中，重发成功后订舱状态流转为“待订舱”，同时移出异常列表，异常图标消失； 若无其他异常，若原订舱状态为：已订舱，重发成功后订舱状态流转为“待订舱”，同时移出异常列表，异常图标消失，订单状态变更为【待确认发船】，同时清空海运前相关字段信息，订单信息同步上游系统，超重标签，集装箱免用时间，已匹配报价的需做相应处理； 若叠加其他异常，且异常原因为【订单更改分区】【订单信息修改】的，按照上述 原订舱状态做相应处理即可； 若叠加其他异常，且异常原因为【订单已取消】的，则订舱状态变更为【已取消】，订单移出异常待处理列表，进入“订舱结果”列表，异常图标消失； 若叠加其他异常，且异常原因为【订单重新申请】的，原订舱状态作废； |

                                  - 

                                  - #### （2）支持批量忽略异常

                                  - - 入口：订舱管理 > 异常待处理tab 列表上方增加功能按钮“批量忽略”；

                                    - 该按钮中的勾选框，支持勾选后筛选出可操作 “忽略“的订单数据，勾选框默认不勾选；（需查询最新数据）

                                    - - 鼠标移入气泡提示：可点击筛选支持忽略异常操作的订单
                                      - 当订单处于审核状态中，列表忽略按钮会置灰，需过滤此类订单；
                                      - 若订单的异常原因仅有【邮件发送失败】 且 失败的是订舱邮件的，不支持操作批量忽略功能，当筛选时需对此类订单进行过滤；

                                    - 

                                    - - 功能权限菜单调整说明：

                                    - 1. 订舱管理 > 异常待处理  菜单下 增加子菜单：批量忽略

                                    - 

                                    - - **功能说明：**

                                    - 1. 点击【批量忽略】按钮，需校验：是否有选择订单数据，若未选，toast提示：请选择订单！

                                      2. 1. 若所选订单存在 “异常原因仅有【邮件发送失败】 且 失败的是订舱邮件的” 的，则toast提示：xxx异常原因为【邮件发送失败】，不支持批量忽略；其中xxx为系统订单号，多个数据分行显示；

                                      3. 若符合校验，打开批量忽略弹窗，样式如下：

                                    - 

                                    - 1. “批量忽略” 弹窗说明：

                                      2. 1. 表头提示文案：请再次确认，以下订单的异常是否会影响订舱，如确认忽略异常，系统将会取消对此异常情况的提示！

                                         2. 列表字段：序号、系统订单号、入库单号、国别、订舱状态、异常原因；其中异常原因文本显示，多个异常的“顿号”分隔；

                                         3. 列表显示所勾选的需要批量忽略的订单数据；

                                         4. 点击“确定”按钮，需判断所选订单中是否含“订舱状态=已订舱，且 因订单更改分区导致目的港清空的订单，若有需出“批量忽略-目的港补录”弹窗，若所选订单中不含上述类型订单，则跳过该弹窗，进行 “确定” 操作的校验；

                                         5. 批量忽略 “确定”按钮，需校验用户角色是否有相应功能权限，若无需toast提示：无功能权限；

                                         6. 同时，需校验说明：

                                         7. 1. 满足校验提交的订单异常忽略成功，不满足校验的订单异常忽略操作失败，异常提示弹窗提示处理失败的订单及失败原因；
                                            2. 所选订单的异常是否已处理，已处理的订单，失败原因为：订单异常已处理，请刷新重试！
                                            3. 所选订单是否并发其他异常，若有订单并发其他异常，失败原因为：订单异常已更新，请刷新重试！
                                            4. 所选订单是否在“修改待审核”、“撤回待审核“、”撤回-驳回“、“内部修改审核” 中，若有订单处于审核状态中，失败原因为：订单xxx，不支持忽略！xxx为具体审核状态；

                                         8. 校验符合后，关闭弹窗，toast提示：success，列表刷新，订单数据更新；

                                         9. 点击【取消】和【X】：弹窗关闭，列表不刷新，数据不发生变更；

                                      3. 

                                      4. 1. “批量忽略-目的港补录”弹窗说明：

                                      5. 

                                      6. 1. 目的港必填，默认显示：请选择；

                                         2. 选项取值：业务配置 > 港口管理 >目的港管理 中 关联区域与订单分配区域一致的所有 有效的 目的港名称合集；

                                         3. 点击“确认”按钮，需校验用户角色是否有相应功能权限，若无需toast提示：无功能权限；

                                         4. 再校验所有订单目的港是否已填，若存在未填的，控件下方红字提示：请填写；

                                         5. 若满足必填校验，需进行下述校验，满足校验的订单异常忽略成功，不满足校验的订单异常忽略操作失败，异常提示弹窗提示处理失败的订单及失败原因；

                                         6. 1. 所选订单的异常是否已处理，已处理的订单，失败原因为：订单异常已处理，请刷新重试！
                                            2. 所选订单是否并发其他异常，若有订单并发其他异常，失败原因为：订单异常已更新，请刷新重试！
                                            3. 所选订单是否在“修改待审核”、“撤回待审核“、”撤回-驳回“、“内部修改审核” 中，若有订单处于审核状态中，失败原因为：订单xxx，不支持忽略！xxx为具体审核状态；
                                            4. 补录目的港的订单，所填写目的港的有效状态，若存在失效的目的港，失败原因为：补录的目的港已失效，操作失败！
                                            5. 补录目的港的订单，所填写的目的港与订单分区是否匹配，若不匹配，失败原因为：补录的目的港与订单分区不匹配，操作失败！

                                         7. 校验符合后，关闭弹窗，toast提示：success，列表刷新，订单数据更新；

                                         8. 点击【取消】和【X】：弹窗关闭，列表不刷新，数据不发生变更；

                                      7. 

                                      8. - 异常提示弹窗样式如下：

                                      9. 

                                      10. 

                                      11. 

                                      12. #### 九、订舱管理列表字段及查询字段调整

                                      13. - **待订舱/订舱中列表：**

                                      14. 1. 列表增加字段：【订单标签】，放在“物流备注”字段前；文本显示标签名称，多个标签的英文逗号分隔；
                                          2. 查询区增加字段：【订单标签】，支持多选，选项为：业务配置 > 业务基础数据管理 > 标签管理中所有的标签；（逻辑与海运订单处标签查询一致）

                                      15. - **订舱结果列表：**

                                      16. 1. 列表增加字段：

                                          2. 1. 【集装箱号】：放在“增值服务”字段前，不固定；
                                             2. 【截单时间】：放在“ETA”字段后；
                                             3. 【货重(kg)】：放在“货代放行”字段后；
                                             4. 【订单标签】：放在“货重”字段后，文本显示标签名称，多个标签的英文逗号分隔；

                                          3. 查询区增加字段：

                                          4. 1. 【集装箱号】：放在“入库单号”字段后，输入框，精确查询；支持批量查询，多个集装箱号会用英文逗号隔开；
                                             2. 【提单号】：放在“船公司”字段后，输入框，支持模糊查询；支持批量查询，多个集装箱号会用英文逗号隔开；
                                             3. 【截单时间】：放在“ETA”字段后，日期区间选择，控件及交互与海运订单管理处一致；
                                             4. 【采购单号】：放在“客户号”字段后，输入框，支持模糊查询；
                                             5. 【订单标签】：放在最后，支持多选，选项为：业务配置 > 业务基础数据管理 > 标签管理中所有的标签；（逻辑与海运订单处标签查询一致）

                                          5. 

                                          6. #### 十、订舱模块导入功能调整

                                          7. - **导入预定舱信息：**

                                          8. 1. 入口：海运业务管理 > 订舱管理 > 待订舱/订舱中 > 导入预定舱信息
                                             2. 导入预定舱信息模版中，增加字段：【订单标签】【起运港备注】【清关备注】【目的港备注】；

                                          9. 

                                          10. 1. 订单标签、起运港备注、清关备注、目的港备注字段支持设置本次更新为 “追加导入” 或 “覆盖导入”；
                                              2. 点击“导入预定舱信息”按钮，打开导入弹窗，弹窗调整如下：

                                          11. 

                                          12. 1. 增加导入方式设置，支持设置的字段有：订单标签、清关备注、起运港备注、目的港备注；
                                              2. 导入方式选项有：追加、覆盖，默认显示为“追加”，支持修改，选项不可清空；
                                              3. 在导入方式设置下增加说明，文案为：说明：除以上可设置字段外，其余字段皆默认为：覆盖导入
                                              4. 在订单标签选项框后增加提示图标，悬移提示文案为：

                                          13. 追加导入：此种导入方式会保留字段原值，导入后同时显示原值及新导入的值；

                                          14. 覆盖导入：此种导入方式会清空字段原值，导入后只显示新导入的值；

                                          15. 1. 上传文件，保存时需根据以上字段设置的导入方式导入信息；
                                              2. 新增字段导入说明：

                                          16. | 订单标签                       | 非必填； 为空不更新； 多个标签英文逗号分隔，用输入的信息与系统里标签管理里的 标签名称 进行匹配；若系统中不存在，则失败原因为：“xxx”标签不存在，其中xxx为标签名称；多个标签不存在的英文逗号隔开，示例：“xxx,xxx”标签不存在； 若用追加的方式导入，且 导入的标签已存在该订单下，则需要去重显示； |
                                              | ------------------------------ | ------------------------------------------------------------ |
                                              | 起运港备注 清关备注 目的港备注 | 非必填； 为空不更新； 限制400字符，若超出，报错提示：xxx超出字符限制，其中xxx为字段名称； |
                                              |                                |                                                              |
                                              |                                |                                                              |

                                          17. 

                                          18. - **导入SO信息：**

                                          19. 1. 入口：海运业务管理 > 订舱管理 > 待订舱/订舱中 > 导入SO
                                              2. 导入模版中，增加字段：是否有火车运输、订单标签、起运港备注、清关备注、目的港备注；
                                              3. 同样：订单标签、起运港备注、清关备注、目的港备注字段支持设置本次更新为 “追加导入” 或 “覆盖导入”；（功能与导入预定舱信息一致，不再赘述）

                                          20. 

                                          21. 1. 新增字段导入说明：

                                          22. | 是否有火车运输                 | 若订单为美国、加拿大的非自发订单，需必填，导入时若无值，报错提示：美/加订单需必填“是否有火车运输”； 若订单为欧日非自发订单，无该字段，导入若有值，报错提示：欧日订单无需填写“是否有火车运输”； 选项：true、false； 若所填信息与上述选项不符，提示：是否有火车运输格式错误； |
                                              | ------------------------------ | ------------------------------------------------------------ |
                                              | 订单标签                       | 非必填； 为空不更新； 多个标签英文逗号分隔，用输入的信息与系统里标签管理里的 标签名称 进行匹配；若系统中不存在，则失败原因为：“xxx”标签不存在，其中xxx为标签名称；多个标签不存在的英文逗号隔开，示例：“xxx,xxx”标签不存在； 若用追加的方式导入，且 导入的标签已存在该订单下，则需要去重显示； |
                                              | 起运港备注 清关备注 目的港备注 | 非必填； 为空不更新； 限制400字符，若超出，报错提示：xxx超出字符限制，其中xxx为字段名称； |
                                              |                                |                                                              |
                                              |                                |                                                              |

                                          23. 

                                          24. - **订舱结果导入：**

                                          25. 1. 入口：海运业务管理 > 订舱管理 > 订舱结果 > 导入

                                              2. 导入模版中增加字段：

                                              3. 1. 【ISF代理简称】【ISF】【清关代理简称】 -- 放在“实际进港日”后；
                                                 2. 【是否有火车运输】 -- 放在“目的港“后；
                                                 3. 【订单标签】【起运港备注】【清关备注】【目的港备注】-- 放在“货代放行”后

                                              4. 

                                              5. 1. 同样：订单标签、起运港备注、清关备注、目的港备注字段支持设置本次更新为 “追加导入” 或 “覆盖导入”；（功能与导入预定舱信息一致，不再赘述）

                                              6. 

                                              7. 1. 新增字段导入说明：

                                              8. | ISF代理简称                    | 非必填，单元格为下拉选择，只能单选； 选项为：业务配置 > 合作代理中，代理类型为“ISF代理”的所有有效代理简称合集（按照unicode排序），下载模版时需要更新选项；下载的数据需符合该账号的数据权限； 当订单为 非B2B的美国/加拿大委托ISF申报的订单时，皆无该字段，导入若有值，失败原因提示为：非B2B美国/加拿大委托ISF申报订单，无需填写ISF代理简称； 若所填值系统中不存在 ，若不存在，失败原因提示为：ISF代理简称不存在； 代理类型是否是清关代理，若不是，失败原因提示为：该代理类型不是ISF代理； 需校验ISF代理的有效性，若无效，失败原因提示为：ISF代理简称已失效； 需校验ISF代理国别与 订单国别是否一致，若不一致，失败原因提示为：ISF代理与订单国别不匹配； 为空不更新； |
                                                 | ------------------------------ | ------------------------------------------------------------ |
                                                 | ISF                            | 非必填；单元格为下拉选择，只能单选； 选项为：已提供、未提供； 只有美国、加拿大非自发订单才有ISF字段，若订单国别不符，失败原因提示为：非美/加订单不支持录入ISF； 若所填值与选项不一致，失败原因提示为：ISF格式错误； 为空不更新 |
                                                 | 清关代理简称                   | 非必填，单元格为下拉选择，只能单选； 选项为：业务配置 > 合作代理中，代理类型为“清关代理”的所有有效代理简称合集（按照unicode排序），下载模版时需要更新选项；下载的数据需符合该账号的数据权限； 当订单的清关方式为：自行安排，订单没有该字段，导入若该字段有值，失败原因提示为：无需导入清关代理简称 若所填值系统中不存在，若不存在，失败原因提示为：清关代理简称不存在 代理类型是否是清关代理，若不是，失败原因提示为：该代理类型不是清关代理； 需校验清关代理的有效性，若无效，失败原因提示为：清关代理已失效； 需校验清关代理国别与订单国别是否一致，若不一致，失败原因提示为：清关代理与订单国别不匹配； 为空不更新； 注：OSJ的订单，若导入的清关代理简称包含“关税代理”的类型，则导入成功后，需自动赋值给费用填写页面的关税代理简称；若不包含“关税代理”类型则不赋值给关税代理简称； |
                                                 | 是否有火车运输                 | 非必填；单元格为下拉选择，只能单选； 选项为：true、false 只有美国、加拿大的订单有该字段，若欧洲、日本订单导入该字段，报错提示：欧日订单无需填写“是否有火车运输”； 若所填值与选项不一致，失败原因提示为：“是否有火车运输”格式错误； 为空不更新 |
                                                 | 订单标签                       | 非必填； 为空不更新； 多个标签英文逗号分隔，用输入的信息与系统里标签管理里的 标签名称 进行匹配；若系统中不存在，则失败原因为：“xxx”标签不存在，其中xxx为标签名称；多个标签不存在的英文逗号隔开，示例：“xxx,xxx”标签不存在； 若用追加的方式导入，且 导入的标签已存在该订单下，则需要去重显示； |
                                                 | 起运港备注 清关备注 目的港备注 | 非必填； 为空不更新； 限制400字符，若超出，报错提示：xxx超出字符限制，其中xxx为字段名称； |
                                                 |                                |                                                              |
                                                 |                                |                                                              |

                                              9. 

                                              10. #### 十一、订舱模块其他优化

                                              11. - **邮件发送中，相关功能不支持操作**

                                              12. 1. 当发送订舱邮件，且邮件处于发送中状态时，需将列表【铅笔编辑】按钮、【录入SO】按钮置灰，显示置灰原因 “邮件发送中，不支持操作”；
                                                  2. 其他操作 > 批量填写货运代理简称，点击“确定”时，增加校验：若所选订单处于订舱邮件处于发送中状态，不支持更改货运代理简称，失败原因显示为：订舱邮件发送中，不支持操作；
                                                  3. 其他操作 > 批量填写船公司，点击“确定”时，增加校验：若所选订单处于订舱邮件处于发送中状态，不支持更改船公司，失败原因显示为：订舱邮件发送中，不支持操作；
                                                  4. 导入 > 导入预定舱信息，系统订单号字段增加校验：若所选订单处于订舱邮件处于发送中状态，不支持导入预定舱信息，失败原因显示为：订舱邮件发送中，不支持操作；
                                                  5. 导入 > 导入SO，系统订单号字段增加校验：若所选订单邮件处于发送中状态，不支持导入SO，失败原因显示为：邮件发送中，不支持操作；

                                              13. 

                                              14. - **待订舱状态下，订舱邮件发送中，若订单产生 “修改审核、取消审核、更改分区、分区驳回、排船驳回”操作，需记录订舱异常，但是不显示在异常待处理列表，也不做异常提示，等邮件发送成功后，在异常待处理列表展示异常，并提示异常；若此邮件发送失败，则忽略记录的这些异常；**

                                              15. 

                                              16. - OSJ订单，通过线上发订舱邮件订舱 > 录入SO > 更改货运代理简称 > 此时操作取消订舱，若更改货运代理简称后列表未刷新的情况下，发取消邮件时，需有抄送人选择的提示弹窗；（目前没有）

                                              17. 

                                              18. - OSJ订单异常处理：

                                              19. 1. 若没有通过线上发订舱邮件，直接录入SO > 此时出现订舱异常 > 当操作取消操作时，并选择发送取消邮件，点击“确定”后，需有抄送人选择的提示弹窗；（目前没有）
                                                  2. 若通过线上发订舱邮件订舱 > 录入SO > 更改货运代理简称 > 此时出现订舱异常 > 在异常列表操作取消订舱，发取消邮件时，需有抄送人选择的提示弹窗；（目前没有）

                                              20. 

                                              21. - 批量操作 订单取消审核、修改审核、分区驳回、排船驳回时，若有提示订舱异常的，弹窗中增加“去处理”文本按钮，如下：

                                                  - - 点击去处理后，跳转至订舱“异常待处理”列表，并对提醒的系统订单号进行批量查询，展示弹窗里所提示的异常订单；

                                                  - 

                                                  - 

                                                  - 

                                                  - #### 十一、海运订单管理调整

                                                  - #### （1）海运订单详情页调整

                                                  - - 【船名航次】字段不再支持在海运订单详情编辑，控件禁用；
                                                    - 将【是否火车运输】字段调整到“海运前”，放在“目的港”字段后，不支持编辑；若值为：是，则 “海运中” 模块需显示字段“提供PU密码”时间；为否则无需显示“提供PU密码”；
                                                    - 【ISF代理简称】字段调整到“海运前”，放在“实际离港日ATD”字段后，控件禁用不支持编辑；
                                                    - 【ISF】字段调整到“海运前”，放在“ISF代理简称”字段后，控件禁用不支持编辑；
                                                    - 【清关代理简称】字段位置保持不变，海运订单管理仍支持编辑；

                                                  - 

                                                  - 

                                                  - #### （2）海运订单导入模版调整

                                                  - 1. 入口：订单管理 > 海运订单管理 > 非自发订单导入

                                                    2. 1. 模版中去掉字段：【船名航次】【ISF代理简称】【ISF】【是否有火车运输】
                                                       2. 模版中增加字段：【订单标签】【起运港备注】【清关备注】【目的港备注】-- 放在“还箱点”字段后

                                                    3. 

                                                    4. 1. 同样：订单标签、起运港备注、清关备注、目的港备注字段支持设置本次更新为 “追加导入” 或 “覆盖导入”；（功能与订舱导入一致，不再赘述）

                                                    5. 