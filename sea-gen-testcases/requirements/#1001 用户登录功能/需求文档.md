# 用户登录功能

**需求编号**: REQ-LOGIN-001
**优先级**: 高
**需求类型**: 功能需求
**创建日期**: 2025-01-02

## 需求描述

系统需要提供用户登录功能，允许已注册用户通过用户名（或手机号/邮箱）和密码登录系统。登录成功后跳转到系统首页，失败时给出明确的错误提示。

## 业务规则

### 1. 正常登录验证
- **前置条件**：
  - 用户已注册且状态正常（未冻结、未删除）
  - 输入的用户名和密码匹配
- **预期结果**：
  - 登录成功，生成登录会话
  - 跳转到系统首页
  - 显示登录成功的提示信息
  - 记录登录日志

### 2. 用户名/密码错误
- **前置条件**：
  - 输入的用户名不存在
  - 或用户名正确但密码错误
- **预期结果**：
  - 登录失败
  - 显示"用户名或密码错误"的提示（不明确说明是用户名还是密码错误，防止暴力破解）
  - 记录登录失败日志

### 3. 密码错误次数限制
- **前置条件**：
  - 同一用户名连续输入错误密码达到3次
- **预期结果**：
  - 账户自动锁定30分钟
  - 显示"账户已锁定，请30分钟后再试"的提示
  - 锁定期间即使输入正确密码也无法登录
  - 30分钟后自动解锁，或管理员手动解锁

### 4. 账号状态检查
- **前置条件**：
  - 用户账号已被冻结
  - 或用户账号已被标记为删除
- **预期结果**：
  - 登录失败
  - 显示"账号已被冻结，请联系管理员"的提示（冻结情况）
  - 或显示"账号不存在"的提示（删除情况）

### 5. 记住密码功能
- **前置条件**：
  - 用户勾选"记住密码"选项
  - 登录成功
- **预期结果**：
  - 在本地存储加密的登录凭证（7天有效期）
  - 下次访问自动登录（在有效期内）
  - 提供"退出登录"功能清除本地凭证

## 验收标准

- [ ] 用户可以使用正确的用户名和密码成功登录
- [ ] 登录成功后正确跳转到首页
- [ ] 用户名或密码错误时显示友好的错误提示
- [ ] 连续3次密码错误后账户被锁定30分钟
- [ ] 锁定期间无法登录，30分钟后自动解锁
- [ ] 被冻结的账号无法登录并显示相应提示
- [ ] "记住密码"功能正常工作，凭证有效期为7天
- [ ] 所有登录操作都被记录到日志中
- [ ] 密码在传输过程中使用HTTPS加密
- [ ] 密码错误提示不泄露具体是用户名还是密码错误

## 界面原型

### 登录页面布局
```
┌─────────────────────────────┐
│                             │
│         系统LOGO            │
│                             │
│  ┌───────────────────────┐  │
│  │ 用户名/手机号/邮箱     │  │
│  └───────────────────────┘  │
│                             │
│  ┌───────────────────────┐  │
│  │ 密码           [显示] │  │
│  └───────────────────────┘  │
│                             │
│  ☐ 记住密码  忘记密码？     │
│                             │
│  │    [ 登 录 ]    │        │
│                             │
│  还没有账号？[立即注册]     │
└─────────────────────────────┘
```

### 字段说明
- **用户名输入框**：支持用户名、手机号、邮箱三种格式，字符限制1-50位
- **密码输入框**：密码以•或*显示，提供"显示"按钮切换明文/密文显示
- **记住密码**：复选框，默认不选中
- **登录按钮**：点击后执行登录操作，登录过程中显示"登录中..."加载状态
- **忘记密码**：链接到密码找回页面
- **立即注册**：链接到注册页面

## 接口说明

### POST /api/auth/login

**请求参数**：
```json
{
  "username": "admin",           // 用户名/手机号/邮箱
  "password": "encrypted_pwd",   // 加密后的密码
  "remember_me": false            // 是否记住密码
}
```

**响应结果（成功）**：
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user_info": {
      "user_id": 10001,
      "username": "admin",
      "nickname": "管理员",
      "role": "admin"
    },
    "expires_in": 7200           // token过期时间（秒）
  }
}
```

**响应结果（失败）**：
```json
{
  "code": 401,
  "message": "用户名或密码错误",
  "data": null
}
```

**响应结果（账户锁定）**：
```json
{
  "code": 423,
  "message": "账户已锁定，请30分钟后再试",
  "data": {
    "locked_until": "2025-01-02T15:30:00Z",
    "remaining_minutes": 28
  }
}
```

## 安全要求

- 密码必须在客户端使用RSA加密后再传输
- 接口必须使用HTTPS协议
- 登录失败3次后需增加图形验证码验证
- Token使用JWT格式，有效期2小时
- "记住密码"功能的本地存储数据必须加密
- 记录所有登录尝试（成功和失败）到安全日志
- 检测到异常登录行为（如短时间内大量失败尝试）时触发告警

## 依赖关系

- **前置需求**：用户注册功能（REQ-REGISTER-001）
- **后续需求**：退出登录（REQ-LOGOUT-001）、修改密码（REQ-CHGPWD-001）
- **相关需求**：账号管理（REQ-ACCOUNT-001）

## 性能要求

- 登录接口响应时间 < 500ms（正常情况）
- 支持100并发登录请求
- 密码加密/解密耗时 < 100ms

## 兼容性要求

- 支持主流浏览器：Chrome、Firefox、Safari、Edge的最新两个版本
- 支持移动端浏览器（iOS Safari、Android Chrome）
- 适配屏幕分辨率：最小320px（移动端）
