# SeaGen Testcases - 海运系统测试用例自动生成工具

帮助软件测试工程师将海运系统需求文档自动转换为测试用例的Claude Code Agent Skill项目。

## 项目结构

```
.
├── .claude/
│   ├── skills/                           # Agent Skills定义
│   │   ├── clean-requirement/            # Skill 1: 需求清洗
│   │   │   └── SKILL.md
│   │   └── gen-test-case/               # Skill 2: 测试用例生成
│   │       └── SKILL.md
│   └── CLAUDE.md                         # 系统背景知识（海运管理系统）
│
├── database-designs/                     # 数据库设计（通用表结构）
│   ├── README.md
│   ├── 公共表设计.md
│   └── 编号序列表.md
│
├── requirements/                         # 需求文档目录
│   ├── #1001 用户登录功能/
│   │   ├── 需求文档.md                   # 产品需求文档
│   │   └── 技术设计.md                   # 技术实现文档（可选，仅参考）
│   └── #71489 新增并单、合并清关、拆分清关功能/
│       ├── 需求文档.md                   # 产品需求文档
│       ├── 表结构变更.md                 # DB变更（强烈推荐）
│       └── 技术文档.md                   # 技术实现文档（可选，仅参考）
│
├── context/                              # 测试上下文配置
│   └── test-context.yaml                # 测试标准、用例规范
│
├── cleaned/                              # 清洗后的需求（JSON格式）
└── testcases/                            # 生成的测试用例（Excel格式）
```

## 什么是Claude Code Skills？

**Skills是Claude Code的AI Agent自动化功能**，不是终端命令。

### 使用方式

| | 终端命令 | Claude Code Skills |
|---|---------|-------------------|
| **使用位置** | 终端/bash | Claude Code对话界面 |
| **本质** | 可执行文件/脚本 | AI Agent自动化流程 |
| **定义方式** | shell/Python代码 | `.claude/skills/*/SKILL.md` |
| **执行者** | 操作系统 | Claude AI |
| **示例** | `python script.py` | `clean-requirement --input "..."` |

### 如何使用Skills

1. **在终端中**：进入项目目录
   ```bash
   cd sea-gen-testcases
   ```

2. **在Claude Code对话中**：直接输入skill命令
   ```
   clean-requirement --input "requirements/#77879 海运系统添加直达中转字段"
   ```

3. **Claude Code会自动**：
   - 读取`.claude/skills/clean-requirement/SKILL.md`
   - 按照定义的步骤执行
   - 生成输出文件并向您报告结果

**重要**：Skills命令只能在Claude Code的对话界面中使用，不能在终端直接运行。

## 工作流程

```
需求文档.md + 表结构变更.md(可选) + 系统背景(CLAUDE.md)
    ↓
[Skill 1: clean-requirement] → 读取database-designs/中的表结构
    ↓
清洗后需求(JSON) → 包含完整的DB信息 + 按功能模块组织的测试场景
    ↓
[Skill 2: gen-test-case] → 读取测试用Excel模板
    ↓
测试用例.xlsx → 可直接导入项目管理系统的Excel文件
```

## 核心设计理念

### 1. 只关注业务功能测试

**不做**：接口测试、性能测试、安全测试
**只做**：业务功能测试

理由：这些测试类型在用户的工作中是单独开展的，不需要在这个项目中体现。

### 2. 测试步骤是独立的测试点

**特点**：
- 一条测试用例包含多个测试步骤
- 步骤之间是独立的测试点，不是因果关系的步骤顺序
- 例如："验证字段显示"和"验证数据保存"是两个独立的步骤

**格式**：用`#`分隔步骤和预期结果
```
步骤描述：#步骤1#步骤2#步骤3
预期结果：#结果1#结果2#结果3
```

### 3. 按功能模块组织测试用例

**从需求到测试用例的转换**：

需求文档：
```
## 1、订舱管理增加字段说明
1）录入SO...
2）导入SO...
3）订舱管理tab...
```

清洗后（business_functions）：
```json
{
  "business_functions": [
    {
      "function_name": "录入SO",
      "scenarios": [...]
    },
    {
      "function_name": "导入SO",
      "scenarios": [...]
    }
  ]
}
```

生成的测试用例：
```
一级模块           | 二级模块 | 用例名称
#77879 海运系统   | 录入SO   | 77879-A001-录入SO
#77879 海运系统   | 导入SO   | 77879-A002-导入SO
```

### 4. 简化的字段映射

| 字段 | 生成方式 | 说明 |
|------|---------|------|
| 一级模块 | 需求名称 | 自动填充 |
| 二/三/四级模块 | 从function_name提取 | 按需生成 |
| 用例名称 | {需求ID}-{场景ID}-{简短描述} | 自动生成 |
| 优先级 | 从业务重要性推断 | P0/P1/P2/P3 |
| 用例类型 | 固定"功能测试" | 不可更改 |
| 前置条件 | 空 | 不生成 |
| 步骤描述 | 用`#`拼接 | 多个独立步骤 |
| 预期结果 | 用`#`拼接 | 对应每个步骤 |
| 备注 | 空 | 不生成 |
| 维护人 | 空 | 用户后续补充 |

## 核心特性

### 1. 四层上下文机制

**第一层：系统背景知识**（`.claude/CLAUDE.md`）
- 存放被测试系统的核心业务信息
- 示例：海运管理系统的订单状态流转、上游系统集成
- **一次性加载**，所有技能都可访问

**第二层：需求与DB文档**（`requirements/{需求ID}/`）
- `需求文档.md`：产品经理写的功能需求
- `表结构变更.md`：DB相关设计（新增字段、新增表、数据流转规则）
- **聚焦DB**：只记录表结构变更，供功能测试验证数据流转

**第三层：通用表结构**（`database-designs/`）
- 存放通用表结构（如t_marine_order、t_receipt_order）
- 供多个需求复用
- 在`表结构变更.md`中引用即可

**第四层：测试配置**（`context/test-context.yaml`）
- 测试用例编写规范
- 优先级定义规则
- 测试数据设计原则

### 2. Skills目录结构

每个Skill独立一个文件夹，包含`SKILL.md`：

```
.claude/skills/
├── clean-requirement/
│   └── SKILL.md          # 需求清洗
└── gen-test-case/
    └── SKILL.md          # 测试用例生成
```

### 3. 测试用例生成特点

**按功能模块组织**：
- 从需求文档中提取功能模块（如"录入SO"、"导入SO"）
- 每个功能模块生成多个测试场景
- 模块层级自动映射到Excel的二/三/四级模块

**只关注业务功能**：
- 不生成接口测试、性能测试、安全测试用例
- 用例类型固定为"功能测试"
- 这些测试类型单独开展，不在此项目中体现

**测试步骤是独立测试点**：
- 一条用例包含多个独立的测试步骤
- 步骤之间无因果关系
- 用`#`分隔，方便导入项目管理系统

## 快速开始

### 1. 准备项目环境

```bash
# 创建目录结构
mkdir -p .claude/skills database-designs requirements context cleaned testcases

# 复制Skills（从本项目）
cp -r .claude/skills/* /你的项目/.claude/skills/
```

### 2. 配置系统背景知识

创建 `.claude/CLAUDE.md`，填写被测系统的核心业务信息：

```markdown
# 海运管理系统 - 项目背景

## 系统定位
海运管理系统，主要用来追踪海运订单的物流信息。

## 上游系统集成
- OSJ、B2B、3PL

## 订单业务维度
- 国别：美国、加拿大、英国、德国、日本
- 类型：非自发、自发、LOCAL

## 订单状态流转
| 操作 | 状态流转 | 状态描述 |
|---|---|---|
| 上游申请入库单 | 待分区 | 正常状态 |
...
```

### 3. 放置需求文档

在 `requirements/` 目录为每个需求创建文件夹：

```bash
requirements/
└── #77879 海运系统添加直达中转字段/
    ├── 需求文档.md          # 产品需求
    ├── 表结构变更.md        # DB变更（可选，推荐）
    ├── 技术文档.md          # 开发技术文档（仅参考，不清洗）
    └── 测试用例导入模板.xlsx  # Excel模板
```

### 4. 执行需求清洗

**在Claude Code对话中输入**：
```
clean-requirement --input "requirements/#77879 海运系统添加直达中转字段"
```

Claude Code会自动：
- 读取需求文档和表结构变更
- 生成清洗后的JSON文件
- 保存到 `cleaned/#77879 海运系统添加直达中转字段-cleaned.json`
- 向您展示清洗摘要

### 5. 生成测试用例

**在Claude Code对话中输入**：
```
gen-test-case --input "cleaned/#77879 海运系统添加直达中转字段-cleaned.json"
```

Claude Code会自动：
- 读取清洗后的JSON
- 生成测试用例Excel文件
- 保存到 `testcases/#77879 海运系统添加直达中转字段-测试用例.xlsx`
- 向您展示生成摘要

### 6. 导入项目管理系统

1. 打开生成的Excel文件
2. 手动调整二/三/四级模块（如果需要）
3. 补充维护人信息
4. 导入到项目管理系统

## Skill功能说明

### Skill 1: clean-requirement（需求清洗）

**功能**：将需求文档和表结构变更解析为结构化JSON

**输入**：
- 需求文件夹路径（包含`需求文档.md`和`表结构变更.md`）
- 系统背景（自动读取`.claude/CLAUDE.md`）
- 数据库设计（自动读取`database-designs/`中的表结构）

**输出**：
- 清洗后的需求JSON文件（包含business_functions）

**关键特性**：
- 按功能模块组织测试场景
- 只关注业务功能测试（不生成接口/性能/安全测试）
- 提取数据库设计信息（用于DB验证测试）

### Skill 2: gen-test-case（测试用例生成）

**功能**：将清洗后的需求转换为可导入的Excel测试用例

**输入**：
- 清洗后的需求JSON文件
- 测试用Excel模板（可选）

**输出**：
- 可直接导入项目管理系统的Excel文件

**关键特性**：
- 生成符合12列模板的Excel
- 测试步骤和预期结果用`#`分隔
- 用例类型固定为"功能测试"
- 一级模块自动填充需求名称
- 二/三/四级模块从功能模块提取

## 文件格式说明

### 需求文档.md（必需）

```markdown
# 需求标题

**需求编号**: REQ-001
**优先级**: 高
**需求类型**: 功能需求

## 需求描述
详细描述功能需求...

## 业务规则
1. 规则1描述
   - 前置条件：...
   - 预期结果：...

## 验收标准
- [ ] 验收标准1

## 依赖关系
- 前置需求：REQ-002
```

### 表结构变更.md（可选，强烈推荐）

```markdown
# #需求编号 表结构变更

## 新增字段
### 1. t_marine_order 表新增字段

| 字段名 | 类型 | 说明 |
|--------|------|------|
| field  | VARCHAR(20) | 字段说明 |

**SQL**：```sql ALTER TABLE ...```

## 数据流转规则
1. 功能A：生成xxx，写入table
2. 功能B：更新table

## 数据验证规则
- 字段互斥
- 格式校验
```

### 清洗后JSON格式

```json
{
  "requirement": {
    "req_id": "REQ-77879",
    "title": "海运系统添加直达/中转字段",
    "module_name": "#77879 海运系统添加直达/中转字段",
    "business_rules": [...]
  },
  "business_functions": [
    {
      "function_name": "录入SO",
      "function_level": "二级模块",
      "scenarios": [
        {
          "scenario_id": "A001",
          "scenario_name": "录入SO - 航程类型字段验证",
          "priority": "P1",
          "test_steps": [...]
        }
      ]
    }
  ]
}
```

## 优势

### 1. 聚焦业务功能测试
- 只关注业务功能，不涉及接口/性能/安全测试
- 这些测试类型单独开展，不在此项目中体现
- 符合实际测试工作流程

### 2. 测试步骤是独立测试点
- 一条用例包含多个独立步骤，无因果关系
- 用`#`分隔，清晰易读
- 符合项目管理系统导入格式

### 3. 按功能模块自动组织
- 从需求文档提取功能模块
- 自动映射到Excel的二/三/四级模块
- 导入前只需微调即可

### 4. 可直接导入
- 生成的Excel符合导入模板
- 第一行包含说明（从模板复制）
- 只需补充维护人信息即可导入

## 快速开始

### 步骤1：在终端中进入项目目录

```bash
cd sea-gen-testcases

# 查看系统背景
cat .claude/CLAUDE.md

# 查看需求文档
ls requirements/#77879\ 海运系统添加直达中转字段/
```

### 步骤2：在Claude Code对话中执行Skills

**执行需求清洗**（在Claude Code对话中输入）：
```
clean-requirement --input "requirements/#77879 海运系统添加直达中转字段"
```

**生成测试用例**（在Claude Code对话中输入）：
```
gen-test-case --input "cleaned/#77879 海运系统添加直达中转字段-cleaned.json"
```

### 步骤3：导入项目管理系统

1. 打开 `testcases/#77879 海运系统添加直达中转字段-测试用例.xlsx`
2. 调整二/三/四级模块
3. 补充维护人
4. 导入项目管理系统

## 注意事项

1. **系统背景要准确**：`.claude/CLAUDE.md`是所有技能的基础
2. **表结构变更很重要**：帮助生成数据库验证测试点
3. **人工校验必要**：清洗后的JSON建议人工检查
4. **用例可调整**：生成后可手动调整模块层级和维护人

## 后续优化

- [ ] 支持Word、PDF格式的需求文档
- [ ] 支持更多测试管理工具的导入格式
- [ ] 增加测试用例优先级自动推断逻辑

## 许可

MIT License
